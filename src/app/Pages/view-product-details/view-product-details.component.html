<main class="product-details-container">
  @if (product) {
    <!-- Breadcrumb & Back -->
    <nav class="breadcrumb-nav">
      <button class="btn-back" (click)="goBack()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        <span>Volver</span>
      </button>
      <div class="breadcrumb">
        <a routerLink="/">Inicio</a>
        <span class="separator">/</span>
        <a [routerLink]="['/categoria', product.category]">{{
          product.category | titlecase
        }}</a>
        <span class="separator">/</span>
        <span class="current">{{ product.name }}</span>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="product-content">
      <!-- Left Side - Image -->
      <section class="product-gallery">
        <div class="main-image-container">
          @if (product.offer) {
            <div class="discount-badge">
              <span class="discount-value">-{{ product.offer }}%</span>
            </div>
          }
          @if (product.freeShipping) {
            <div class="shipping-badge">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="1" y="3" width="15" height="13"></rect>
                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                <circle cx="18.5" cy="18.5" r="2.5"></circle>
              </svg>
              <span>Envío gratis</span>
            </div>
          }
          <img [src]="product.image" [alt]="product.name" class="main-image" />
        </div>

        <!-- Store Badge -->
        <div class="store-card" (click)="goToStore()">
          <img [src]="storeLogoUrl" [alt]="storeName" class="store-logo" />
          <div class="store-info">
            <span class="store-label">Vendido por</span>
            <span class="store-name">{{ storeName || "Tienda Oficial" }}</span>
          </div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </div>
      </section>

      <!-- Right Side - Info -->
      <section class="product-info">
        <div class="info-header">
          <span class="brand">{{ product.brand }}</span>
          @if (product.ratings) {
            <div class="rating">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                ></polygon>
              </svg>
              <span class="rating-value">{{ product.ratings }}</span>
              @if (product.reviews) {
                <span class="reviews">({{ product.reviews }} reseñas)</span>
              }
            </div>
          }
        </div>

        <h1 class="product-title">{{ product.name }}</h1>

        <p class="product-description">{{ product.description }}</p>

        <!-- Price Section -->
        <div class="price-section">
          @if (product.offer) {
            <div class="price-with-discount">
              <span class="original-price"
                >${{ product.price | number: "1.0-0" : "es-AR" }}</span
              >
              <span class="current-price"
                >${{ getDiscountedPrice() | number: "1.0-0" : "es-AR" }}</span
              >
            </div>
            <div class="savings-badge">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                ></path>
              </svg>
              <span
                >Ahorrás ${{ getSavings() | number: "1.0-0" : "es-AR" }}</span
              >
            </div>
          } @else {
            <span class="current-price"
              >${{ product.price | number: "1.0-0" : "es-AR" }}</span
            >
          }
        </div>

        <!-- Stock Info -->
        @if (product.stock) {
          <div class="stock-info" [class.low-stock]="product.stock < 5">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
              ></path>
            </svg>
            @if (product.stock < 5) {
              <span>¡Solo quedan {{ product.stock }} unidades!</span>
            } @else {
              <span>{{ product.stock }} unidades disponibles</span>
            }
          </div>
        }

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-primary btn-buy" (click)="visitProductUrl()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path
                d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
              ></path>
            </svg>
            Ver en tienda oficial
          </button>

          <div class="secondary-actions">
            <button
              class="btn-icon"
              [class.active]="isFavorite"
              (click)="toggleFavorite()"
              [title]="
                isFavorite ? 'Quitar de favoritos' : 'Agregar a favoritos'
              "
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="22"
                viewBox="0 0 24 24"
                [attr.fill]="isFavorite ? 'currentColor' : 'none'"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                ></path>
              </svg>
            </button>

            @if (!isInComparison) {
              <button
                class="btn-icon"
                (click)="addToComparison()"
                title="Agregar a comparación"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="22"
                  height="22"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="18" y1="20" x2="18" y2="10"></line>
                  <line x1="12" y1="20" x2="12" y2="4"></line>
                  <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
              </button>
            } @else {
              <button
                class="btn-icon active"
                (click)="removeFromComparison()"
                title="Quitar de comparación"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="22"
                  height="22"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </button>
            }
          </div>
        </div>

        @if (isInComparison) {
          <a routerLink="/comparativas" class="comparison-link">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            Ver en comparativas
          </a>
        }

        <!-- Quick Info Cards (inside product-info) -->
        <div class="quick-info-grid">
          <div class="quick-info-item">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="1" y="3" width="15" height="13"></rect>
              <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
              <circle cx="5.5" cy="18.5" r="2.5"></circle>
              <circle cx="18.5" cy="18.5" r="2.5"></circle>
            </svg>
            <span>{{
              product.freeShipping ? "Envío gratis" : "Envío a todo el país"
            }}</span>
          </div>
          <div class="quick-info-item">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            <span>12 meses de garantía</span>
          </div>
          <div class="quick-info-item">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <span>Compra protegida</span>
          </div>
          <div class="quick-info-item">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
              ></path>
            </svg>
            <span>Devolución gratis</span>
          </div>
        </div>

        <!-- Payment Methods (compact, inside product-info) -->
        <div class="payment-compact">
          <h4>Medios de pago</h4>
          <div class="payment-icons">
            <div class="payment-icon" title="Visa">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#1A1F71" />
                <text
                  x="25"
                  y="18"
                  fill="#fff"
                  font-size="9"
                  font-weight="bold"
                  text-anchor="middle"
                >
                  VISA
                </text>
              </svg>
            </div>
            <div class="payment-icon" title="Mastercard">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#f5f5f5" />
                <circle cx="18" cy="15" r="8" fill="#EB001B" />
                <circle cx="32" cy="15" r="8" fill="#F79E1B" />
              </svg>
            </div>
            <div class="payment-icon" title="American Express">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#006FCF" />
                <text
                  x="25"
                  y="18"
                  fill="#fff"
                  font-size="6"
                  font-weight="bold"
                  text-anchor="middle"
                >
                  AMEX
                </text>
              </svg>
            </div>
            <div class="payment-icon" title="MercadoPago">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#00BCFF" />
                <text
                  x="25"
                  y="18"
                  fill="#002D6B"
                  font-size="5"
                  font-weight="bold"
                  text-anchor="middle"
                >
                  MercadoPago
                </text>
              </svg>
            </div>
            <span class="more-payments">+5</span>
          </div>
          <p class="installments-text">
            Hasta <strong>12 cuotas sin interés</strong>
          </p>
        </div>
      </section>
    </div>

    <!-- Specifications Section -->
    @if (product.caracteristics) {
      <section class="specifications-section">
        <div class="section-header">
          <h2>Especificaciones técnicas</h2>
          <div class="header-decoration"></div>
        </div>

        <div class="specs-grid">
          @for (spec of getCharacteristics(); track spec.key) {
            <div class="spec-card">
              <div class="spec-icon">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <div class="spec-content">
                <span class="spec-label">{{ spec.key }}</span>
                <span class="spec-value">{{ spec.value }}</span>
              </div>
            </div>
          }
        </div>
      </section>
    }
  } @else {
    <!-- Loading State -->
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando producto...</p>
    </div>
  }
</main>
