<main class="product-details-container">
  @if (product) {
    <!-- Breadcrumb & Back -->
    <nav class="breadcrumb-nav">
      <button class="btn-back" (click)="goBack()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        <span>Volver</span>
      </button>
      <div class="breadcrumb">
        <a routerLink="/">Inicio</a>
        <span class="separator">/</span>
        <a [routerLink]="['/categoria', product.category]">{{
          product.category | titlecase
        }}</a>
        <span class="separator">/</span>
        <span class="current">{{ product.name }}</span>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="product-content">
      <!-- Left Side - Image -->
      <section class="product-gallery">
        <div class="main-image-container">
          @if (product.offer) {
            <div class="card-offer">
              <span class="material-symbols-outlined offer-icon">percent_discount</span>
              <span class="offer-text">{{ product.offer }}% OFF</span>
            </div>
          }

          @if (product.freeShipping) {
            <div class="free-shipping-badge">
              <span class="material-symbols-outlined truck-icon">delivery_truck_speed</span>
              <span class="shipping-text">Envío gratis</span>
            </div>
          }

          <img [src]="product.image" [alt]="product.name" class="main-image" />
        </div>

        <!-- Store Badge -->
        <div class="store-card" (click)="goToStore()">
          <img [src]="storeLogoUrl" [alt]="storeName" class="store-logo" />
          <div class="store-info">
            <span class="store-label">Vendido por</span>
            <span class="store-name">{{ storeName || "Tienda Oficial" }}</span>
          </div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </div>
      </section>

      <!-- Right Side - Info -->
      <section class="product-info">
        <div class="info-header">
          <span class="brand">{{ product.brand }}</span>
          @if (product.ratings) {
            <div class="rating-container">
              
              <span class="rating-value">{{ product.ratings }}</span>

              <div class="stars-wrapper">
                @for (star of getStars(); track $index) {
                  <span class="material-symbols-outlined star-icon" [ngClass]="star.class">
                    {{ star.icon }}
                  </span>
                }
              </div>
              
              @if (product.reviews) {
                <span class="reviews-count">({{ product.reviews }} reseñas)</span>
              }
            </div>
          }
        </div>

        <h1 class="product-title">{{ product.name }}</h1>

        <p class="product-description">{{ product.description }}</p>

        <!-- Price Section -->
        <div class="price-section">
          @if (product.offer) {
            <div class="price-with-discount">
              <div class="original-price-row">
                <span class="original-price">${{ product.price | number: "1.0-0" : "es-AR" }}</span>
                
                <div class="savings-badge-premium">
                  <span class="material-symbols-outlined money-icon">paid</span>
                  <span class="savings-text">Ahorrás ${{ getSavings() | number: "1.0-0" : "es-AR" }}</span>
                </div>
              </div>

              <span class="current-price">
                ${{ getDiscountedPrice() | number: "1.0-0" : "es-AR" }}<span class="decimal-small">00</span>
              </span>
            </div>
          } @else {
            <span class="current-price">
              ${{ product.price | number: "1.0-0" : "es-AR" }}<span class="decimal-small">00</span>
            </span>
          }
        </div>

        <!-- Stock Info -->
        @if (product.stock) {
          <div class="stock-info" [class.low-stock]="product.stock < 5">
            @if (product.stock < 5) {
              <span>¡Solo quedan {{ product.stock }} unidades!</span>
            } @else {
              <span>{{ product.stock }} unidades disponibles</span>
            }
          </div>
        }

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-primary btn-buy" (click)="visitProductUrl()">
            <span class="material-symbols-outlined">shopping_cart</span>
            Ver en tienda oficial
          </button>

          <div class="secondary-actions">
            
            <button 
              class="btn-round" 
              [class.is-active]="isFavorite" 
              (click)="toggleFavorite()" 
              title="Agregar a favoritos">
              <span class="material-symbols-outlined">favorite</span>
            </button>

            <button 
              class="btn-round" 
              [class.is-active]="isInComparison" 
              (click)="isInComparison ? removeFromComparison() : addToComparison()" 
              title="Comparar producto">
              <span class="material-symbols-outlined">balance</span>
            </button>

          </div>
        </div>

        @if (isInComparison) {
          <a routerLink="/comparativas" class="comparison-link">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
            Ver en comparativas
          </a>
        }

        <!-- Quick Info Cards (inside product-info) -->
        <div class="quick-info-grid">
          <div class="quick-info-item">
            <span class="material-symbols-outlined quick-icon">delivery_truck_speed</span>
            <span>{{ product.freeShipping ? "Envío gratis" : "Envío a todo el país" }}</span>
          </div>

          <div class="quick-info-item">
            <span class="material-symbols-outlined quick-icon">verified_user</span>
            <span>12 meses de garantía</span>
          </div>

          <div class="quick-info-item">
            <span class="material-symbols-outlined quick-icon">lock</span>
            <span>Compra protegida</span>
          </div>

          <div class="quick-info-item">
            <span class="material-symbols-outlined quick-icon">box</span>
            <span>Devolución gratis</span>
          </div>
        </div>

        <!-- Payment Methods (compact, inside product-info) -->
        <div class="payment-compact">
          <h4>Medios de pago</h4>
          <div class="payment-icons">
            <div class="payment-icon" title="Visa">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#1A1F71" />
                <text
                  x="25"
                  y="18"
                  fill="#fff"
                  font-size="9"
                  font-weight="bold"
                  text-anchor="middle"
                >
                  VISA
                </text>
              </svg>
            </div>
            <div class="payment-icon" title="Mastercard">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#f5f5f5" />
                <circle cx="18" cy="15" r="8" fill="#EB001B" />
                <circle cx="32" cy="15" r="8" fill="#F79E1B" />
              </svg>
            </div>
            <div class="payment-icon" title="American Express">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#006FCF" />
                <text
                  x="25"
                  y="18"
                  fill="#fff"
                  font-size="6"
                  font-weight="bold"
                  text-anchor="middle"
                >
                  AMEX
                </text>
              </svg>
            </div>
            <div class="payment-icon" title="MercadoPago">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="20"
                viewBox="0 0 50 30"
              >
                <rect width="50" height="30" rx="3" fill="#00BCFF" />
                <text
                  x="25"
                  y="18"
                  fill="#002D6B"
                  font-size="5"
                  font-weight="bold"
                  text-anchor="middle"
                >
                  MercadoPago
                </text>
              </svg>
            </div>
            <span class="more-payments">+5</span>
          </div>
          <p class="installments-text">
            Hasta <strong>12 cuotas sin interés</strong>
          </p>
        </div>
      </section>
    </div>

    <!-- Specifications Section -->
    @if (product.caracteristics) {
      <section class="specifications-section">
        <div class="section-header">
          <h2>Especificaciones técnicas</h2>
          <div class="header-decoration"></div>
        </div>

        <div class="specs-grid">
          @for (spec of getCharacteristics(); track spec.key) {
            <div class="spec-card">
              
              <div class="spec-icon">
                <span class="material-symbols-outlined">{{ spec.icon }}</span>
              </div>
              
              <div class="spec-content">
                <span class="spec-label">{{ spec.key }}</span>
                <span class="spec-value">{{ spec.value }}</span>
              </div>
            </div>
          }
        </div>
      </section>
    }
  } @else {
    <!-- Loading State -->
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando producto...</p>
    </div>
  }
</main>
