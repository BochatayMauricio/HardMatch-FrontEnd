<div class="settings-container">
  <!-- Header -->
  <header class="settings-header">
    <div class="header-content">
      <h1>Preferencias de Matching</h1>
      <p class="header-subtitle">
        Personaliza c√≥mo encontramos los productos perfectos para ti
      </p>
    </div>

    <!-- Progress indicator -->
    <div class="progress-section">
      <div class="progress-bar">
        <div
          class="progress-fill"
          [style.width.%]="getProgressPercentage()"
        ></div>
      </div>
      <span class="progress-text"
        >{{ getProgressPercentage() }}% completado</span
      >
    </div>
  </header>

  <div class="settings-layout">
    <!-- Sidebar Navigation -->
    <nav class="settings-nav">
      <button
        class="nav-item"
        [class.active]="activeSection === 'categories'"
        (click)="setActiveSection('categories')"
      >
        <span class="nav-icon">üì±</span>
        <span class="nav-label">Categor√≠as</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'budget'"
        (click)="setActiveSection('budget')"
      >
        <span class="nav-icon">üí∞</span>
        <span class="nav-label">Presupuesto</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'brands'"
        (click)="setActiveSection('brands')"
      >
        <span class="nav-icon">üè∑Ô∏è</span>
        <span class="nav-label">Marcas</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'priorities'"
        (click)="setActiveSection('priorities')"
      >
        <span class="nav-icon">‚ö°</span>
        <span class="nav-label">Prioridades</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'alerts'"
        (click)="setActiveSection('alerts')"
      >
        <span class="nav-icon">üîî</span>
        <span class="nav-label">Alertas</span>
      </button>
    </nav>

    <!-- Main Content -->
    <main class="settings-content">
      <!-- =============================================
           SECCI√ìN: CATEGOR√çAS DE INTER√âS
           ============================================= -->
      <section *ngIf="activeSection === 'categories'" class="settings-section">
        <div class="section-header">
          <h2>Categor√≠as de Inter√©s</h2>
          <p class="section-description">
            Selecciona los tipos de productos sobre los que quieres recibir
            recomendaciones
          </p>
        </div>

        <div class="categories-grid">
          <button
            *ngFor="let cat of categories"
            class="category-card"
            [class.selected]="isCategorySelected(cat.value)"
            (click)="toggleCategory(cat.value)"
          >
            <span class="category-icon">
              <ng-container [ngSwitch]="cat.icon">
                <span *ngSwitchCase="'laptop'">üíª</span>
                <span *ngSwitchCase="'tablet'">üì±</span>
                <span *ngSwitchCase="'smartphone'">üì≤</span>
                <span *ngSwitchCase="'monitor'">üñ•Ô∏è</span>
                <span *ngSwitchCase="'keyboard'">‚å®Ô∏è</span>
                <span *ngSwitchCase="'mouse'">üñ±Ô∏è</span>
                <span *ngSwitchCase="'headphones'">üéß</span>
                <span *ngSwitchCase="'hard-drive'">üíæ</span>
                <span *ngSwitchCase="'cpu'">üîß</span>
                <span *ngSwitchDefault>üì¶</span>
              </ng-container>
            </span>
            <span class="category-label">{{ cat.label }}</span>
            <span class="check-indicator" *ngIf="isCategorySelected(cat.value)"
              >‚úì</span
            >
          </button>
        </div>

        <div class="section-divider"></div>

        <!-- Tipos de uso -->
        <div class="section-header">
          <h3>¬øPara qu√© los usar√°s?</h3>
          <p class="section-description">
            Esto nos ayuda a entender mejor tus necesidades
          </p>
        </div>

        <div class="usage-grid">
          <button
            *ngFor="let usage of usageTypes"
            class="usage-card"
            [class.selected]="isUsageTypeSelected(usage.value)"
            (click)="toggleUsageType(usage.value)"
          >
            <span class="usage-icon">{{ usage.icon }}</span>
            <div class="usage-info">
              <span class="usage-label">{{ usage.label }}</span>
              <span class="usage-description">{{ usage.description }}</span>
            </div>
            <span
              class="check-indicator"
              *ngIf="isUsageTypeSelected(usage.value)"
              >‚úì</span
            >
          </button>
        </div>
      </section>

      <!-- =============================================
           SECCI√ìN: PRESUPUESTO
           ============================================= -->
      <section *ngIf="activeSection === 'budget'" class="settings-section">
        <div class="section-header">
          <h2>Rango de Presupuesto</h2>
          <p class="section-description">
            Define tu presupuesto para filtrar productos dentro de tu alcance
          </p>
        </div>

        <div class="budget-display">
          <div class="price-range-visual">
            <div class="price-box">
              <span class="price-label">M√≠nimo</span>
              <span class="price-value">{{
                formatPrice(preferences.priceRange.minPrice)
              }}</span>
            </div>
            <div class="price-separator">
              <span class="separator-line"></span>
              <span class="separator-text">hasta</span>
              <span class="separator-line"></span>
            </div>
            <div class="price-box">
              <span class="price-label">M√°ximo</span>
              <span class="price-value">{{
                formatPrice(preferences.priceRange.maxPrice)
              }}</span>
            </div>
          </div>
        </div>

        <div class="range-sliders">
          <div class="slider-group">
            <label for="minPrice">Precio m√≠nimo</label>
            <input
              type="range"
              id="minPrice"
              [min]="priceSliderMin"
              [max]="priceSliderMax"
              [step]="priceStep"
              [value]="preferences.priceRange.minPrice"
              (input)="updatePriceRange('min', $event)"
              class="price-slider"
            />
          </div>

          <div class="slider-group">
            <label for="maxPrice">Precio m√°ximo</label>
            <input
              type="range"
              id="maxPrice"
              [min]="priceSliderMin"
              [max]="priceSliderMax"
              [step]="priceStep"
              [value]="preferences.priceRange.maxPrice"
              (input)="updatePriceRange('max', $event)"
              class="price-slider"
            />
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="toggle-option">
          <div class="toggle-info">
            <span class="toggle-label">Presupuesto flexible</span>
            <span class="toggle-description">
              Ocasionalmente mostrar productos ligeramente fuera de tu rango si
              son relevantes
            </span>
          </div>
          <label class="toggle-switch">
            <input
              type="checkbox"
              [(ngModel)]="preferences.flexibleBudget"
              (change)="markAsChanged()"
            />
            <span class="toggle-slider"></span>
          </label>
        </div>
      </section>

      <!-- =============================================
           SECCI√ìN: MARCAS PREFERIDAS
           ============================================= -->
      <section *ngIf="activeSection === 'brands'" class="settings-section">
        <div class="section-header">
          <h2>Preferencias de Marcas</h2>
          <p class="section-description">
            Haz clic para marcar como preferida (verde) o excluir (rojo). Clic
            de nuevo para desmarcar.
          </p>
        </div>

        <div class="brand-legend">
          <span class="legend-item">
            <span class="legend-dot preferred"></span> Preferida
          </span>
          <span class="legend-item">
            <span class="legend-dot neutral"></span> Neutral
          </span>
          <span class="legend-item">
            <span class="legend-dot excluded"></span> Excluida
          </span>
        </div>

        <div class="brands-grid">
          <button
            *ngFor="let brand of brands"
            class="brand-card"
            [class.preferred]="isBrandPreferred(brand.value)"
            [class.excluded]="isBrandExcluded(brand.value)"
            (click)="cycleBrandState(brand.value)"
          >
            <span class="brand-name">{{ brand.value }}</span>
            <span class="brand-status">
              <ng-container *ngIf="isBrandPreferred(brand.value)"
                >‚úì</ng-container
              >
              <ng-container *ngIf="isBrandExcluded(brand.value)"
                >‚úó</ng-container
              >
            </span>
          </button>
        </div>

        <div class="section-divider"></div>

        <div class="toggle-option">
          <div class="toggle-info">
            <span class="toggle-label">Abierto a nuevas marcas</span>
            <span class="toggle-description">
              Recibir recomendaciones de marcas que no conoces pero podr√≠an
              interesarte
            </span>
          </div>
          <label class="toggle-switch">
            <input
              type="checkbox"
              [(ngModel)]="preferences.openToNewBrands"
              (change)="markAsChanged()"
            />
            <span class="toggle-slider"></span>
          </label>
        </div>
      </section>

      <!-- =============================================
           SECCI√ìN: PRIORIDADES
           ============================================= -->
      <section *ngIf="activeSection === 'priorities'" class="settings-section">
        <div class="section-header">
          <h2>Prioridades de Matching</h2>
          <p class="section-description">
            Arrastra para ordenar seg√∫n tu importancia. El primero es el m√°s
            importante.
          </p>
        </div>

        <div class="priorities-list">
          <div
            *ngFor="let priority of preferences.priorities; let i = index"
            class="priority-item"
            [class.dragging]="draggedPriority === priority"
            draggable="true"
            (dragstart)="onDragStart($event, priority)"
            (dragover)="onDragOver($event)"
            (drop)="onDrop($event, priority)"
            (dragend)="onDragEnd()"
          >
            <span class="priority-rank">{{ i + 1 }}</span>
            <span class="priority-icon">{{ getPriorityIcon(priority) }}</span>
            <span class="priority-label">{{ getPriorityLabel(priority) }}</span>
            <span class="drag-handle">‚ãÆ‚ãÆ</span>
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="priorities-available">
          <span class="available-label">Agregar prioridades:</span>
          <div class="available-chips">
            <button
              *ngFor="let p of priorities"
              class="priority-chip"
              [class.active]="isPriorityInList(p.value)"
              (click)="togglePriorityInList(p.value)"
            >
              {{ p.icon }} {{ p.label }}
            </button>
          </div>
        </div>
      </section>

      <!-- =============================================
           SECCI√ìN: ALERTAS
           ============================================= -->
      <section *ngIf="activeSection === 'alerts'" class="settings-section">
        <div class="section-header">
          <h2>Alertas y Notificaciones</h2>
          <p class="section-description">
            Configura cu√°ndo y c√≥mo quieres recibir notificaciones de matches
          </p>
        </div>

        <div class="alerts-list">
          <div class="alert-option">
            <div class="alert-info">
              <span class="alert-icon">üìâ</span>
              <div class="alert-text">
                <span class="alert-title">Bajada de precio</span>
                <span class="alert-description"
                  >Cuando un producto que segu√≠s baja de precio</span
                >
              </div>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                [checked]="preferences.alerts.priceDropAlert"
                (change)="toggleAlert('priceDropAlert')"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="alert-option">
            <div class="alert-info">
              <span class="alert-icon">üéØ</span>
              <div class="alert-text">
                <span class="alert-title">Nuevo match</span>
                <span class="alert-description"
                  >Cuando encontramos un producto perfecto para vos</span
                >
              </div>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                [checked]="preferences.alerts.newMatchAlert"
                (change)="toggleAlert('newMatchAlert')"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="alert-option">
            <div class="alert-info">
              <span class="alert-icon">üì¶</span>
              <div class="alert-text">
                <span class="alert-title">Stock disponible</span>
                <span class="alert-description"
                  >Cuando vuelve a haber stock de un producto agotado</span
                >
              </div>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                [checked]="preferences.alerts.stockAlert"
                (change)="toggleAlert('stockAlert')"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="alert-option">
            <div class="alert-info">
              <span class="alert-icon">üî•</span>
              <div class="alert-text">
                <span class="alert-title">Ofertas especiales</span>
                <span class="alert-description"
                  >Descuentos exclusivos y promociones</span
                >
              </div>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                [checked]="preferences.alerts.dealAlert"
                (change)="toggleAlert('dealAlert')"
              />
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="frequency-section">
          <h3>Frecuencia de alertas</h3>
          <div class="frequency-options">
            <button
              *ngFor="let freq of alertFrequencies"
              class="frequency-btn"
              [class.active]="preferences.alerts.alertFrequency === freq.value"
              (click)="updateAlertFrequency(freq.value)"
            >
              <span class="freq-label">{{ freq.label }}</span>
              <span class="freq-description">{{ freq.description }}</span>
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Footer con acciones -->
  <footer class="settings-footer">
    <span class="save-message" *ngIf="saveMessage">{{ saveMessage }}</span>
    <div class="footer-actions">
      <button
        class="btn btn-secondary"
        (click)="resetPreferences()"
        [disabled]="isLoading"
      >
        Restablecer
      </button>
      <button
        class="btn btn-primary"
        (click)="savePreferences()"
        [disabled]="!hasChanges || isLoading"
      >
        <span *ngIf="!isLoading">Guardar cambios</span>
        <span *ngIf="isLoading">Guardando...</span>
      </button>
    </div>
  </footer>
</div>
